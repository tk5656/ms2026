# ロリポップサーバーへのデプロイ手順（FileZilla使用）

## 📋 デプロイ前の準備チェックリスト

### 1. ファイルの準備
- [ ] SCSSファイルがCSSにコンパイルされている（既にコンパイル済みのようです）
- [ ] `config.php`をロリポップ用の設定に変更
- [ ] `index.php`のエラー表示設定を本番環境用に変更（`display_errors = '0'`）

### 2. データベースの準備
- [ ] ロリポップの管理画面でデータベースを作成
- [ ] `miraire.sql`をインポートする準備

---

## 🚀 FileZillaでのアップロード手順

### ステップ1: FileZillaの接続設定

1. **FileZillaを起動**
2. **「ファイル」→「サイトマネージャー」**を開く
3. **「新しいサイト」**をクリック
4. 以下の情報を入力：
   ```
   プロトコル: SFTP - SSH File Transfer Protocol
   ホスト: [ロリポップのFTPサーバーアドレス]
   ポート: 22（SFTPの場合）または 21（FTPの場合）
   ログインタイプ: 通常
   ユーザー: [ロリポップのFTPユーザー名]
   パスワード: [ロリポップのFTPパスワード]
   ```
5. **「接続」**をクリック

### ステップ2: ファイルのアップロード

1. **左側（ローカル）**: `c:\xampp\htdocs\ms2026\miraire` フォルダを開く
2. **右側（リモート）**: ロリポップの `public_html` または `www` フォルダを開く
   - 通常は `/home/users/[ユーザー名]/[ドメイン名]/` 配下
   - または `/home/users/[ユーザー名]/web/` 配下

3. **アップロードするフォルダ**:
   
   **必須でアップロードするフォルダは2つです：**
   
   ```
   📁 miraire/          ← メインのアプリケーションフォルダ
   ├── css/             （すべてのCSSファイル - コンパイル済み）
   ├── images/          （すべての画像ファイル）
   ├── js/              （すべてのJavaScriptファイル）
   ├── tpl/             （すべてのテンプレートファイル）
   ├── index.php
   ├── vote.php
   ├── voting_completed.php
   ├── character.html
   └── config.php       （ロリポップ用に設定変更済み）
   
   📁 isometric/        ← 投票機能で使用する画像フォルダ
   ├── 0_penji_convenienceStore/
   ├── 0_penji_parts/
   ├── 1_nyoroaki_art/
   ├── 1_nyoroaki_parts/
   ├── 2_kokezo_beerGarden/
   ├── 2_kokezo_parts/
   ├── 3_ichiro_parts/
   ├── 3_ichiro_smokingArea/
   ├── 4_nyamiko_gamingRoom/
   └── 4_nyamiko_parts/
   ```
   
   **重要**: `miraire`と`isometric`は**同じ階層**に配置してください。
   
   サーバー上の構造：
   ```
   public_html/
   ├── miraire/
   └── isometric/
   ```

4. **アップロード方法**:
   
   **手順A: miraireフォルダのアップロード**
   - 左側（ローカル）で `c:\xampp\htdocs\ms2026\miraire` フォルダを選択
   - 右側（リモート）で `public_html` フォルダを開く
   - `miraire`フォルダ全体をドラッグ&ドロップでアップロード
   
   **手順B: isometricフォルダのアップロード**
   - 左側（ローカル）で `c:\xampp\htdocs\ms2026\isometric` フォルダを選択
   - 右側（リモート）で `public_html` フォルダを開く（miraireと同じ階層）
   - `isometric`フォルダ全体をドラッグ&ドロップでアップロード
   
   **注意**: 
   - `miraire`と`isometric`は必ず同じ階層（`public_html`直下）に配置
   - フォルダ内のすべてのファイルとサブフォルダがアップロードされることを確認

### ステップ3: ファイルの権限設定（必要に応じて）

- PHPファイル: `644` または `755`
- フォルダ: `755`
- 設定ファイル（config.php）: `600` または `644`（セキュリティのため）

---

## ⚙️ サーバー側の設定

### 1. config.phpの設定変更

ロリポップの管理画面で確認した情報を`config.php`に反映：

```php
// ロリポップサーバー環境
const HOST = 'mysql80-2.lolipop'; // ロリポップのホスト名（管理画面で確認）
const USER = 'LAA1691490'; // ロリポップのデータベースユーザー名
const DB = 'LAA1691490-miraire'; // ロリポップのデータベース名
const PASSWORD = 'DG12PW11'; // ロリポップのデータベースパスワード
```

**注意**: 実際の値はロリポップの管理画面で確認してください。

### 2. データベースのインポート

1. ロリポップの管理画面にログイン
2. **「データベース」** → **「phpMyAdmin」**を開く
3. 作成したデータベースを選択
4. **「インポート」**タブをクリック
5. `miraire.sql`ファイルを選択してアップロード
6. **「実行」**をクリック

### 3. エラー表示の確認

`index.php`の設定を確認：
```php
ini_set('display_errors', '0'); // 本番環境では必ず0
```

---

## 🔍 デプロイ後の確認事項

- [ ] サイトにアクセスして表示を確認
- [ ] データベース接続が正常に動作しているか確認
- [ ] 画像が正しく表示されるか確認
- [ ] JavaScriptが正常に動作するか確認
- [ ] 投票機能が正常に動作するか確認

---

## 📝 トラブルシューティング

### ファイルが見つからないエラー
- ファイルパスが正しいか確認
- 大文字小文字を区別するサーバーもあるので注意

### データベース接続エラー
- `config.php`の設定値を再確認
- ロリポップの管理画面でデータベース情報を確認

### 画像が表示されない
- 画像ファイルが正しくアップロードされているか確認
- パスが相対パスで正しく指定されているか確認

### CSSが反映されない
- CSSファイルが正しくアップロードされているか確認
- ブラウザのキャッシュをクリア（Ctrl+F5）

---

## 🔐 セキュリティ注意事項

- `config.php`にはデータベースのパスワードが含まれているため、Git管理から除外されています
- 本番環境では必ず`display_errors = '0'`に設定
- 必要に応じて`.htaccess`でアクセス制限を設定
