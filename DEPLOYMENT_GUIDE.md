# ロリポップサーバーへのアップロード手順

## 事前準備

### 1. ロリポップの管理画面にログイン
1. ロリポップの公式サイト（https://lolipop.jp/）にアクセス
2. ユーザー専用ページにログイン
3. サーバー管理画面を開く

### 2. データベース情報の確認
1. 管理画面の「データベース」メニューを開く
2. 以下の情報を確認・メモしてください：
   - **データベース名**（例：`your_database_name`）
   - **データベースユーザー名**（例：`your_username`）
   - **データベースパスワード**
   - **データベースホスト名**（例：`mysql1234.db.sakura.ne.jp`）

### 3. FTP接続情報の確認
1. 管理画面の「FTP」メニューを開く
2. 以下の情報を確認・メモしてください：
   - **FTPサーバー名**（例：`ftp.lolipop.jp`）
   - **FTPユーザー名**
   - **FTPパスワード**
   - **FTPポート**（通常は`21`）

## ステップ1: データベースの作成と設定

### 1-1. データベースの作成（まだ作成していない場合）
1. ロリポップ管理画面の「データベース」→「データベース作成」
2. データベース名を入力して作成
3. 作成されたデータベースの情報をメモ

### 1-2. SQLファイルの実行
1. ロリポップ管理画面の「データベース」→「phpMyAdmin」を開く
2. 作成したデータベースを選択
3. 「SQL」タブをクリック
4. `miraire.sql`ファイルを開いて、内容をすべてコピー
5. SQLタブのテキストエリアに貼り付け
6. 「実行」ボタンをクリック
7. エラーがなければ成功です

## ステップ2: 設定ファイルの準備

### 2-1. `miraire/config.php`の編集
1. ローカルの`miraire/config.php`ファイルを開く
2. ロリポップのデータベース情報に書き換える：

```php
<?php
// データベース接続設定
// 注意: このファイルはGit管理外です（.gitignoreに追加済み）

// ロリポップサーバー環境
const HOST = 'mysql1234.db.sakura.ne.jp'; // ロリポップのホスト名（管理画面で確認）
const USER = 'your_username'; // ロリポップのデータベースユーザー名
const DB = 'your_database_name'; // ロリポップのデータベース名
const PASSWORD = 'your_password'; // ロリポップのデータベースパスワード
?>
```

**重要**: 上記の`your_username`、`your_database_name`、`your_password`を実際の値に置き換えてください。

## ステップ3: FTPソフトの準備

### 3-1. FTPソフトのインストール（まだの場合）
以下のいずれかをインストール：
- **FileZilla**（無料、おすすめ）: https://filezilla-project.org/
- **WinSCP**（Windows用、無料）: https://winscp.net/
- **Cyberduck**（Mac用、無料）: https://cyberduck.io/

### 3-2. FTP接続の設定
1. FTPソフトを起動
2. 新しい接続を作成：
   - **ホスト名**: FTPサーバー名（例：`ftp.lolipop.jp`）
   - **ユーザー名**: FTPユーザー名
   - **パスワード**: FTPパスワード
   - **ポート**: `21`（通常）
   - **プロトコル**: `FTP`または`SFTP`（ロリポップの設定に応じて）

## ステップ4: ファイルのアップロード

### 4-1. アップロードするファイル・フォルダ
以下のフォルダとファイルをアップロードします：

```
ms2026/
├── miraire/          ← このフォルダ全体
│   ├── config.php   ← 編集済みのファイル
│   ├── index.php
│   ├── vote.php
│   ├── vote_result.php
│   ├── css/
│   ├── js/
│   ├── images/
│   └── tpl/
└── isometric/       ← このフォルダ全体（画像ファイル）
    ├── 2_kokezo_beerGarden/
    ├── 2_kokezo_parts/
    ├── 3_ichiro_smokingArea/
    ├── 3_ichiro_parts/
    ├── 4_nyamiko_gamingRoom/
    └── 4_nyamiko_parts/
```

### 4-2. アップロード手順（FileZillaの場合）
1. FTPソフトでロリポップサーバーに接続
2. サーバー側のディレクトリを確認（通常は`/`または`/public_html/`）
3. ローカル側で`ms2026`フォルダを開く
4. 以下のフォルダをドラッグ&ドロップでアップロード：
   - `miraire`フォルダ全体
   - `isometric`フォルダ全体
5. アップロードが完了するまで待つ（画像ファイルが多いので時間がかかります）

### 4-3. ディレクトリ構造の確認
サーバー側で以下のような構造になっていることを確認：

```
/public_html/（またはルートディレクトリ）
├── miraire/
│   ├── config.php
│   ├── index.php
│   ├── vote.php
│   └── ...
└── isometric/
    ├── 2_kokezo_beerGarden/
    └── ...
```

**注意**: ロリポップによっては`public_html`フォルダ内にアップロードする必要があります。

## ステップ5: 動作確認

### 5-1. ベーシック認証の設定（テスト環境の場合）
1. ロリポップ管理画面の「アクセス制限」または「ベーシック認証」を開く
2. テスト環境用のユーザー名とパスワードを設定
3. 保護するディレクトリを指定（通常は全体）

### 5-2. ブラウザでアクセス
1. ブラウザで以下のURLにアクセス：
   - `https://your-domain.lolipop.jp/miraire/index.php`
   - または `https://your-domain.lolipop.jp/miraire/`
2. ベーシック認証のダイアログが表示されたら、設定したユーザー名とパスワードを入力
3. ページが表示されることを確認

### 5-3. 動作確認チェックリスト
- [ ] トップページ（`index.php`）が表示される
- [ ] 投票ページ（`vote.php`）が表示される
- [ ] キャラクターのスライドが表示される
- [ ] 「このキャラに投票する」ボタンをクリックしてモーダルが表示される
- [ ] 投票処理が動作する（エラーが出ない）
- [ ] 画像が正しく表示される

## トラブルシューティング

### エラー: データベース接続に失敗しました
- `miraire/config.php`の設定を確認
- データベース情報が正しいか確認
- データベースが作成されているか確認

### エラー: 画像が表示されない
- `isometric`フォルダが正しくアップロードされているか確認
- 画像パス（`../isometric/...`）が正しいか確認
- ファイルのパーミッション（権限）を確認（通常は`644`）

### エラー: ページが表示されない（404エラー）
- ファイルが正しいディレクトリにアップロードされているか確認
- URLのパスが正しいか確認
- `.htaccess`ファイルが必要な場合は作成

### エラー: 日本語が文字化けする
- データベースの文字コードが`utf8mb4`になっているか確認
- PHPファイルが`UTF-8`で保存されているか確認

## よくある質問

### Q: どのフォルダにアップロードすればいいですか？
A: ロリポップの場合は通常`public_html`フォルダ内にアップロードします。管理画面で確認してください。

### Q: `config.php`はアップロードしますか？
A: はい、編集済みの`config.php`をアップロードしてください。ただし、Git管理には含めないでください（`.gitignore`に追加済み）。

### Q: 画像ファイルが多くてアップロードに時間がかかります
A: 正常です。画像ファイルが多いので、アップロード完了まで待ってください。中断しないように注意してください。

### Q: ベーシック認証を設定しないとどうなりますか？
A: テスト環境では設定することをおすすめします。本番環境では必要に応じて設定してください。

## 次のステップ

アップロードが完了したら：
1. 動作確認を行う
2. エラーが出た場合は上記のトラブルシューティングを参照
3. 問題が解決しない場合は、エラーメッセージを確認してロリポップのサポートに問い合わせる

