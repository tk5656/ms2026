# システム設計

## データベース設計

### ER図（概念）
<!-- プロジェクトに応じてER図を記載 -->
```
users (1) ──< (N) posts
users (1) ──< (N) comments
```

### テーブル設計の原則
1. **正規化**: データの重複を避ける
2. **外部キー制約**: データの整合性を保つ
3. **インデックス**: 検索速度を向上させる
4. **文字コード**: `utf8mb4`に統一

### データベース操作の原則
- **SQL文は1か所にまとめる**（モデルクラスやDAOパターン）
- **直接DBを触らない**（必ずアプリケーション経由）
- **トランザクション**: 複数のSQLを実行する場合は使用

## ファイル構成設計

### ディレクトリ構造の原則
```
プロジェクトルート/
├── config/          # 設定ファイル
├── src/             # ソースコード
│   ├── models/      # データモデル
│   ├── controllers/ # コントローラー
│   ├── views/       # ビュー（テンプレート）
│   └── utils/       # ユーティリティ
├── public/          # 公開ディレクトリ
└── sql/             # SQLファイル
```

### 簡易版の構成例
```
プロジェクトルート/
├── config.php       # 設定
├── index.php        # エントリーポイント
├── models/          # データモデル
├── views/           # ビュー
├── js/              # JavaScript
├── css/             # スタイル
└── init.sql         # 初期データ
```

## 処理フロー設計

### 一般的な処理の詳細フロー
```
1. リクエスト受信
   ↓
2. 入力値の検証
   ↓
3. データベース接続
   ↓
4. データの取得/更新
   ↓
5. データベースを更新
   ↓
6. レスポンスを返す
```

### エラーハンドリングの設計
```
処理開始
   ↓
エラーチェック
   ├─ エラーあり → エラーレスポンス返却
   └─ エラーなし → 正常処理
```

## セキュリティ設計

### 入力値検証の階層
```
1. クライアント側（JavaScript）
   └─ UX向上のため（必須ではない）

2. サーバー側（PHP）
   └─ 必須（セキュリティのため）
```

### SQLインジェクション対策
```php
// 悪い例（絶対にNG）
$sql = "SELECT * FROM users WHERE id = " . $_GET['id'];

// 良い例（プリペアドステートメント）
$stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
$stmt->execute([$_GET['id']]);
```

### XSS対策
```php
// 悪い例（絶対にNG）
echo $_GET['name'];

// 良い例（エスケープ）
echo htmlspecialchars($_GET['name'], ENT_QUOTES, 'UTF-8');
```

## パフォーマンス設計

### データベースクエリの最適化
- 必要なカラムのみ取得（`SELECT *`は避ける）
- インデックスを適切に設定
- N+1問題を避ける（JOINを使用）

### キャッシュ戦略
- 静的ファイルはブラウザキャッシュを活用
- 頻繁にアクセスされるデータはキャッシュ（将来実装）

## 拡張性の考慮

### 将来の拡張を見据えた設計
- 機能追加を想定したディレクトリ構造
- 設定ファイルの外部化
- ログ機能の実装（将来）

### コードの保守性
- 関数化（再利用可能な処理）
- コメントの適切な記述
- 命名規則の統一
